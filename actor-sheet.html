<form class="{{cssClass}} flexcol{{#if flags.inline-secrets}} inline-secrets{{/if}}" autocomplete="off">
	<nav class="switches">
		<ul>
			<li>
				<a class="switch" data-control="attack-descriptions"
				>{{#if flags.attack-descriptions}}Hide{{else}}Show{{/if}} automatic attack descriptions</a>
			</li>
			<li>
				<a class="switch" data-control="inline-secrets"
				>{{#if flags.inline-secrets}}Disable{{else}}Enable{{/if}} inline secrets.</a>
			</li>
			<li>
				<a class="switch" data-control="hide-profile-image"
				>{{#if flags.hide-profile-image}}Show{{else}}Hide{{/if}} profile image.</a>
			</li>
			<li>
				<a class="switch" data-control="show-lair-actions"
				>{{#if flags.show-lair-actions}}Hide{{else}}Show{{/if}} lair actions.</a>
			</li>
		</ul>
	</nav>
    <header class="sheet-header">
		<section id="monster-identity">
			<h1 class="charname">{{actor.name}}<!--input name="name" type="text" value="{{actor.name}}" placeholder="Name"/--></h1>
			<p class="chartype">{{lookup config.actorSizes data.traits.size}}<span class="sep">&nbsp;</span>{{data.details.type}}<span class="sep">, </span>{{data.details.alignment}}</p>
			{{#unless flags.hide-profile-image}}<figure class="profile-image" style="background-image: url({{actor.img}});" title="{{actor.name}}" data-edit="img"/></figure>{{/unless}}
		</section>
		<section id="monster-attributes1">
			<ul class="attributes">
				<li class="attribute">
					<h4 class="attribute-name box-title">{{ localize "DND5E.ArmorClass" }} </h4>
					<span class="attr-value">{{data.attributes.ac.value}}</span>
					<input name="data.attributes.ac.value" type="text" value="{{data.attributes.ac.value}}"
                               data-dtype="Number" placeholder="10"/>
				</li>
				<li class="attribute health">
					<h4 class="attribute-name box-title rollable">{{ localize "DND5E.Health" }} </h4>
					<span class="attr-value">{{data.attributes.hp.value}}</span>
					<input name="data.attributes.hp.value" type="text" value="{{data.attributes.hp.value}}"
                               data-dtype="Number" placeholder="10"/>
                    <span class="sep">&nbsp;/&nbsp;</span>
					<span class="attr-value">{{data.attributes.hp.max}}</span>
                    <input name="data.attributes.hp.max" type="text" value="{{data.attributes.hp.max}}"
                               data-dtype="Number" placeholder="10"/>
					<span class="sep">&nbsp;(</span>
					<span class="attr-value">{{data.attributes.hp.formula}}</span>
					<input name="data.attributes.hp.formula" class="hpformula" type="text" placeholder="{{ localize 'DND5E.HealthFormula' }}"
                               value="{{data.attributes.hp.formula}}"/>
					<span class="sep">)</span>
				</li>
				<li class="attribute">
                    <h4 class="attribute-name box-title">{{ localize "DND5E.Speed" }} </h4>
					<span class="attr-value">{{data.attributes.speed.value}}</span>
                    <input name="data.attributes.speed.value" type="text"
						value="{{data.attributes.speed.value}}" placeholder="0"/>
					<span class="sep">, </span>
					<span class="attr-value">{{data.attributes.speed.special}}</span>
                    <input type="text" class="speed" name="data.attributes.speed.special"
                        value="{{data.attributes.speed.special}}" placeholder="{{ localize 'DND5E.SpeedSpecial' }}"/>
                </li>
			</ul>
		</section>
		<section id="monster-abilities">
			<ul class="ability-scores flexrow">
            {{#each data.abilities as |ability id|}}
                <li class="ability {{#if ability.proficient}}proficient{{/if}}" data-ability="{{id}}">
                    <h4 class="ability-name box-title rollable">{{id}}</h4>
					<span class="attr-value">{{ability.value}} </span>
                    <input class="ability-score" name="data.abilities.{{id}}.value" type="text" value="{{ability.value}}" data-dtype="Number" placeholder="10"/>
					<span class="ability-mod" title="Modifier">({{numberFormat ability.mod decimals=0 sign=true}})</span>
					<input type="hidden" name="data.abilities.{{id}}.proficient" value="{{ability.proficient}}" data-dtype="Number"/>
					<!--a class="proficiency-toggle ability-proficiency" title="{{ localize 'DND5E.Proficiency' }}">{{{ability.icon}}}</a-->
					<!--span class="ability-save" title="Saving Throw">{{numberFormat ability.save decimals=0 sign=true}}</span-->
                </li>
            {{/each}}
            </ul>
		</section>
		<section id="monster-attributes2">
			<ul class="attributes">
				{{#if (hassave data.abilities)}}
				<li class="monster-saves">
					<h4 class="attribute-name">{{localize "DND5E.SavingThrows"}}&nbsp;</h4>
					<ul class="inline-list">
					{{#each data.abilities as |ability id|}}
					{{#if ability.proficient}}
						<li class="ability {{#if ability.proficient}}proficient{{/if}}" data-ability="{{id}}">
							<span class="ability-name rollable">{{id}}</span>
							<span class="ability-save" title="Saving Throw">&nbsp;{{numberFormat ability.save decimals=0 sign=true}}</span>
							<!--a class="proficiency-toggle ability-proficiency" title="{{ localize 'DND5E.Proficiency' }}">{{{ability.icon}}}</a-->
						</li>
					{{/if}}
					{{/each}}
					</ul>
				</li>
				{{/if}}
				{{#if (hasskills data.skills)}}
				<li class="monster-skills">
					<h4 class="attribute-name">{{localize "DND5E.Skills"}}&nbsp;</h4>
					<ul class="inline-list">
					{{#each data.skills as |skill s|}}
					{{#if skill.value}}
						<li class="skill {{#if skill.value}}proficient{{/if}}" data-skill="{{s}}">
							<span class="skill-name rollable">{{skill.label}}</span>
							<span class="skill-mod">&nbsp;{{numberFormat skill.total decimals=0 sign=true}}</span>
						</li>
					{{/if}}
					{{/each}}
					</ul>
				</li>
				{{/if}}
				{{#if (hascontents data.traits.dv.selected)}}
				<li class="attribute">
					<h4 class="attribute-name">{{localize "DND5E.DamVuln"}}&nbsp;</h4>
					<ul class="traits-list inline-list">
					{{#each data.traits.dv.selected as |v k|}}
						<li class="tag {{k}}"><span class="trait-value">{{v}}</span></li>
					{{/each}}
					</ul>
				</li>
				{{/if}}
				{{#if (hascontents data.traits.dr.selected)}}
				<li class="attribute">
					<h4 class="attribute-name">{{localize "DND5E.DamRes"}}&nbsp;</h4>
					<ul class="traits-list inline-list">
					{{#each data.traits.dr.selected as |v k|}}
						<li class="tag {{k}}"><span class="trait-value">{{v}}</span></li>
					{{/each}}
					</ul>
				</li>
				{{/if}}
				{{#if (hascontents data.traits.di.selected)}}
				<li class="attribute">
					<h4 class="attribute-name">{{localize "DND5E.DamImm"}}&nbsp;</h4>
					<ul class="traits-list inline-list">
					{{#each data.traits.di.selected as |v k|}}
						<li class="tag {{k}}"><span class="trait-value">{{v}}</span></li>
					{{/each}}
					</ul>
				</li>
				{{/if}}
				{{#if (hascontents data.traits.ci.selected)}}
				<li class="attribute">
					<h4 class="attribute-name">{{localize "DND5E.ConImm"}}&nbsp;</h4>
					<ul class="traits-list inline-list">
					{{#each data.traits.ci.selected as |v k|}}
						<li class="tag {{k}}"><span class="trait-value">{{v}}</span></li>
					{{/each}}
					</ul>
				</li>
				{{/if}}
				<li class="attribute">
					<h4 class="attribute-name">{{localize "DND5E.Senses"}}&nbsp;</h4>
					<span class="trait-value">{{data.traits.senses}}</span>
				</li>
				<li class="attribute">
					<h4 class="attribute-name">{{localize "DND5E.Languages"}}&nbsp;</h4>
					<ul class="traits-list inline-list">
					{{#each data.traits.languages.selected as |v k|}}
						<li class="tag {{k}}"><span class="trait-value">{{v}}</span></li>
					{{/each}}
					</ul>
				</li>
				<li class="attribute">
					<h4 class="attribute-name">{{localize "DND5E.ChallengeRating"}}&nbsp;</h4>
					<span class="trait-value">{{labels.cr}}</span><span>&nbsp;({{data.details.xp.value}} XP)</span>
				</li>
			</ul>
		</section>
    </header>
	{{#*inline "featureBlock"}}
	<section class="item monster-feature" data-item-id="{{item._id}}">
		<div class="feature-description inline-children">
			<span class="feature-name">{{item.name}}</span>
			<span class="description">{{{enrichhtml item.data.description.value}}}</span>
		</div>
	</section>
	{{/inline}}
	
	{{#each (getfeatures features) as |item iid|}}
		{{#if (notspecialaction item)}}{{> featureBlock item=item}}{{/if}}
	{{/each}}
	<h2 class="section-header" >{{localize "DND5E.ActionPl"}}</h2>
	{{#if (getmultiattack)}}
		{{> featureBlock item=(getmultiattack)}}
	{{/if}}
	{{#each (getattacks features) as |item iid|}}
	{{#if (notspecialaction item)}}
	<section class="item monster-action" data-item-id="{{item._id}}">
		<div class="attack-description rollable inline-children">
			<span class="attack-name item-name">{{item.name}}</span>
			{{#if ../flags.attack-descriptions}}
			<span class="generated-text">
				<span class="attack-type">{{localize (getattacktype item)}}</span>
				<span class="attack-bonus">{{numberFormat (getattackbonus item ../data) decimals=0 sign=true}} to hit, </span>
				<span>reach {{item.data.range.value}} {{item.data.range.units}}.</span><br>
				<span class="hit-label">Hit:&nbsp;</span>
				<span>{{! average damage }} ({{item.data.damage.parts.[0].[0]}}) {{item.data.damage.parts.[0].[1]}} damage.&nbsp;</span>
			</span>
			{{/if}}
			<span class="description">{{{enrichhtml item.data.description.value}}}</span>
		</div>
	</section>
	{{/if}}
	{{/each}}
	{{#each (getactions features) as |item iid|}}
		{{#if (notspecialaction item)}}
			{{> featureBlock item=item}}
		{{/if}}
	{{/each}}
	{{! Legendary Actions }}
	{{#if (haslegendary features)}}
		<h2 class="section-header" >{{localize "DND5E.LegAct"}}</h2>
		<p>The {{actor.name}} can take [3] legendary actions, chooseing from the options below. Only one legendary action option can be used at a time and only at the end of another creature's turn. The {{actor.name}} regains spent legendary actions at the start of its turn.</p>
		{{#each (getactions features) as |item iid|}}
			{{#if (islegendary item)}}{{> featureBlock item=item}}{{/if}}
		{{/each}}
	{{/if}}
	{{! Lair Actions }}
	{{#if (haslair features)}}
	{{#if flags.show-lair-actions}}
		<h2 class="section-header" >Lair {{localize "DND5E.ActionPl"}}</h2>
		{{#each (getactions features) as |item iid|}}
			{{#if (islair item)}}{{> featureBlock item=item}}{{/if}}
		{{/each}}
	{{/if}}
	{{/if}}
	
	<!-- This element is required to calculate the actual width of the column layout in order to size the popup to the sheet -->
	<span id="endAnchor"></span>
</form>